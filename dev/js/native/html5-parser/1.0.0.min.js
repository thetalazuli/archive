/*
 * HTML5 Parser By Sam Blowes
 *
 * Designed for HTML5 documents
 *
 * Original code by John Resig (ejohn.org)
 * http://ejohn.org/blog/pure-javascript-html-parser/
 * Original code by Erik Arvidsson, Mozilla Public License
 * http://erik.eae.net/simplehtmlparser/simplehtmlparser.js
 *
 * ----------------------------------------------------------------------------
 * License
 * ----------------------------------------------------------------------------
 *
 * This code is triple licensed using Apache Software License 2.0,
 * Mozilla Public License or GNU Public License
 * 
 * ////////////////////////////////////////////////////////////////////////////
 * 
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License.  You may obtain a copy
 * of the License at http://www.apache.org/licenses/LICENSE-2.0
 * 
 * ////////////////////////////////////////////////////////////////////////////
 * 
 * The contents of this file are subject to the Mozilla Public License
 * Version 1.1 (the "License"); you may not use this file except in
 * compliance with the License. You may obtain a copy of the License at
 * http://www.mozilla.org/MPL/
 * 
 * Software distributed under the License is distributed on an "AS IS"
 * basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
 * License for the specific language governing rights and limitations
 * under the License.
 * 
 * The Original Code is Simple HTML Parser.
 * 
 * The Initial Developer of the Original Code is Erik Arvidsson.
 * Portions created by Erik Arvidssson are Copyright (C) 2004. All Rights
 * Reserved.
 * 
 * ////////////////////////////////////////////////////////////////////////////
 * 
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
 *
 * ----------------------------------------------------------------------------
 * Usage
 * ----------------------------------------------------------------------------
 *
 * // Use like so:
 * HTMLParser(htmlString, {
 *     start: function(tag, attrs, unary) {},
 *     end: function(tag) {},
 *     chars: function(text) {},
 *     comment: function(text) {}
 * });
 *
 * // or to get an XML string:
 * HTMLtoXML(htmlString);
 *
 * // or to get an XML DOM Document
 * HTMLtoDOM(htmlString);
 *
 * // or to inject into an existing document/DOM node
 * HTMLtoDOM(htmlString, document);
 * HTMLtoDOM(htmlString, document.body);
 *
 */
!function(){var d=/^<([-A-Za-z0-9_]+)((?:\s+[a-zA-Z_:][-a-zA-Z0-9_:.]*(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,u=/^<\/([-A-Za-z0-9_]+)[^>]*>/,m=/([a-zA-Z_:][-a-zA-Z0-9_:.]*)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,f=r("area,base,basefont,br,col,frame,hr,img,input,link,meta,param,embed,command,keygen,source,track,wbr"),p=r("a,address,article,applet,aside,audio,blockquote,button,canvas,center,dd,del,dir,div,dl,dt,fieldset,figcaption,figure,footer,form,frameset,h1,h2,h3,h4,h5,h6,header,hgroup,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,output,p,pre,section,script,table,tbody,td,tfoot,th,thead,tr,ul,video"),h=r("abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),g=r("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),b=r("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),v=r("script,style"),D=this.HTMLParser=function(e,o){var t,n,a,i=[],r=e;for(i.last=function(){return this[this.length-1]};e;){if(n=!0,i.last()&&v[i.last()])e=e.replace(new RegExp("([\\s\\S]*?)</"+i.last()+"[^>]*>"),function(e,t){return t=t.replace(/<!--([\s\S]*?)-->|<!\[CDATA\[([\s\S]*?)]]>/g,"$1$2"),o.chars&&o.chars(t),""}),l("",i.last());else if(0==e.indexOf("\x3c!--")?0<=(t=e.indexOf("--\x3e"))&&(o.comment&&o.comment(e.substring(4,t)),e=e.substring(t+3),n=!1):0==e.indexOf("</")?(a=e.match(u))&&(e=e.substring(a[0].length),a[0].replace(u,l),n=!1):0==e.indexOf("<")&&(a=e.match(d))&&(e=e.substring(a[0].length),a[0].replace(d,c),n=!1),n){var s=(t=e.indexOf("<"))<0?e:e.substring(0,t);e=t<0?"":e.substring(t),o.chars&&o.chars(s)}if(e==r)throw"Parse Error: "+e;r=e}function c(e,t,n,a){if(t=t.toLowerCase(),p[t])for(;i.last()&&h[i.last()];)l("",i.last());if(g[t]&&i.last()==t&&l("",t),(a=f[t]||!!a)||i.push(t),o.start){var r=[];n.replace(m,function(e,t){var n=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:b[t]?t:"";r.push({name:t,value:n,escaped:n.replace(/(^|[^\\])"/g,'$1\\"')})}),o.start&&o.start(t,r,a)}}function l(e,t){if(t)for(n=i.length-1;0<=n&&i[n]!=t;n--);else var n=0;if(0<=n){for(var a=i.length-1;n<=a;a--)o.end&&o.end(i[a]);i.length=n}}l()};function r(e){for(var t={},n=e.split(","),a=0;a<n.length;a++)t[n[a]]=!0;return t}this.HTMLtoXML=function(e){var r="";return D(e,{start:function(e,t,n){r+="<"+e;for(var a=0;a<t.length;a++)r+=" "+t[a].name+'="'+t[a].escaped+'"';r+=">"},end:function(e){r+="</"+e+">"},chars:function(e){r+=e},comment:function(e){r+="\x3c!--"+e+"--\x3e"}}),r},this.HTMLtoDOM=function(e,o){var i=r("html,head,body,title"),s={link:"head",base:"head"};o?o=o.ownerDocument||o.getOwnerDocument&&o.getOwnerDocument()||o:"undefined"!=typeof DOMDocument?o=new DOMDocument:"undefined"!=typeof document&&document.implementation&&document.implementation.createDocument?o=document.implementation.createDocument("","",null):"undefined"!=typeof ActiveX&&(o=new ActiveXObject("Msxml.DOMDocument"));var t,n,c=[];if(!(o.documentElement||o.getDocumentElement&&o.getDocumentElement())&&o.createElement&&(t=o.createElement("html"),(n=o.createElement("head")).appendChild(o.createElement("title")),t.appendChild(n),t.appendChild(o.createElement("body")),o.appendChild(t)),o.getElementsByTagName)for(var a in i)i[a]=o.getElementsByTagName(a)[0];var l=i.body;return D(e,{start:function(e,t,n){if(i[e])return l=i[e],void(n||c.push(l));var a=o.createElement(e);for(var r in t)a.setAttribute(t[r].name,t[r].value);s[e]&&"boolean"!=typeof i[s[e]]?i[s[e]].appendChild(a):l&&l.appendChild&&l.appendChild(a),n||(c.push(a),l=a)},end:function(e){c.length-=1,l=c[c.length-1]},chars:function(e){l.appendChild(o.createTextNode(e))},comment:function(e){}}),o}}();