
<head>
  <title></title>
  <meta name='description' content='一個の記事にたくさんの情報が詰まっている'>
  <link href='example3.png' rel='icon'>
</head>

 <style>
  @import url('/css/fomantic-ui/2.7.8.min.css');
  @import url('/js/native/code-mirror/5.48.4.min.css');
  @import url('/js/native/code-mirror/addon/dialog/dialog.css');
  @import url('/js/native/code-mirror/addon/hint/show-hint.css');
  @import url('/js/native/code-mirror/addon/fold/foldgutter.css');
  @import url('/js/native/code-mirror/addon/display/fullscreen.css');
  @import url('/js/native/code-mirror/addon/scroll/simplescrollbars.css');
  @import url('/js/native/code-mirror/addon/search/matchesonscrollbar.css');

  html,
  body{
    font:12px 'M+2VM+IPAG circle';
  }
  main{
    width:148mm;
    margin:0 auto;
  }
  .ui.grid>.row>.column.article{
    padding-right:2.7em;
  }
  .ui.menu,
  .ui.label,
  .ui.segments{
    border-bottom: 2px solid rgba(34,36,38,.15) !important;
    box-shadow: rgba(16, 36, 94, 0.4) 0 2px 6px 0 !important;
  }
  .ui.popup{
     border:none;
     box-shadow:none;
     padding:0 !important;
     padding-right:0;
   }
   .ui.popup .dg.main .close-button{
     display:none;
   }
   .ui.popup .dg.main{
     width:100% !important;
   }
  nav{
    position: absolute;
    text-align: right;
    width: calc(100% + 2.2em);
    z-index: 9;
    left: -0;
    top: -1em;
  }


  .ui.grid>.row.controller{
    position:sticky;
    z-index:99;
    top:0;
  }

  .ui.segment.editor{
    padding:0;
  }
  .indexes > .ui.label:nth-of-type(1){
     background-color: #767676;
     border-color: #767676;
   }
   .indexes > .ui.label:nth-of-type(2){
     background-color: #a5673f;
     border-color: #a5673f;
   }
   .indexes > .ui.label:nth-of-type(3){
     background-color: #e03997;
     border-color: #e03997;
   }
   .indexes > .ui.label:nth-of-type(4){
     background-color: #a333c8;
     border-color: #a333c8;
   }
   .indexes > .ui.label:nth-of-type(5){
     background-color: #6435c9;
     border-color: #6435c9;
   }
   .indexes > .ui.label:nth-of-type(6){
     background-color: #2185d0;
     border-color: #2185d0;
   }
   .indexes > .ui.label:nth-of-type(7){
     background-color: #00b5ad;
     border-color: #00b5ad;
   }
   .indexes > .ui.label:nth-of-type(8){
     background-color: #21ba45;
     border-color: #21ba45;
   }
   .indexes > .ui.label:nth-of-type(9){
     background-color: #b5cc18;
     border-color: #b5cc18;
   }
   .indexes > .ui.label:nth-of-type(10){
     background-color: #fbbd08;
     border-color: #fbbd08;
   }
   /*
   .indexes > .ui.label:nth-of-type(11){
     background-color: #f2711c;
     border-color: #f2711c;
   }
   .indexes > .ui.label:nth-of-type(12){
     background-color: #db2828;
     border-color: #db2828;
   }
   */
   .indexes > .ui.label.active{
     background-color: white!important;
     border-color: white!important;
     color: black!important;
   }
   .indexes > .ui.label{
     color:white;
   }

   .ui.multiple.search.dropdown>.text>.ui.label>.icon{
     font-size:10px;
   }
   .ui.multiple.search.dropdown>.text{
     margin:0;
   }
   .ui.multiple.search.dropdown>input.search{
     margin: .35238095em 0 .35238095em .64285714em;
     margin-top:.33238095em;
     vertical-align:middle;
   }
   .ui.multiple.dropdown>.label{
     font-size:.85714286rem;
     padding:.5833em .833em;


     margin-bottom:0;
     margin-top:0;

   }
   .ui.selection.dropdown{
     background:transparent;
     vertical-align:top;
     padding-bottom:0;
     min-height:auto;
     padding-top:0;
     border:none;
   }
   .ui.label>.delete.icon {
     display:none;
   }
   .ui.label>.icon{
     margin-right:0;
   }
   .ui.indexes.labels{
     display:inline-block;
   }
   .ui.page.segment{
     padding-top:2.0rem;
     padding-bottom:1.7rem;
   }
   p{
     line-height:1.2;
   }



</style>
 <body>
   <main>


<div class='ui grid padded brain'>

        <!-- そろそろ地上に降ろす -->
        <div class='row generator'  v-if='index == null'>
            <div class='column article'>
    

              <!--

                いわばこれは会話の粒度である
                例えば、鉱物と押せば、英名・和名・産地・成分といった
                エレメントがある。この型があれば鉱物好きと話せるというわけだ
                つまり、相手の纏め方を可視化しブログという形で知ることにより
                何を知っていれば話が弾むのか、わかるようになり
                コミュニケーションがまるで自分の知っていること或いは
                知りたいことを自己紹介する形で
                繋がれるようになる
                腹の探り合いはなくなる
              -->

              <!-- 種をまく -->
        
              <div class='ui segments'>
                <div class='ui segment'>
                   <nav class='ui labels' style='margin-left:-1.7em;'>
                      <div class='ui pointing below label orange'>
                          <img src='https://avatars0.githubusercontent.com/u/1024025?v=4'>
                          </div>
                  </nav>
                  <section>...</section>
              <section> 
                
                <!-- ここはアバター画像になる -->
                </section>
                </div></div>
                <div class='ui  labels' style='margin-left:-1.7em;'>
                    <div class='ui pointing below label orange'>
                      日記
                      </div><div @click='pusha' class='ui label orange'>単体<div class='ui detail'>10</div></div><div @click='pushx' class='ui label orange'>鉱物<div class='ui detail'>10</div></div><div @click='pushb' class='ui label orange'>鑑賞<div class='ui detail'>99</div></div>
                    </div>
                    <!--
                      守・破・離
                      確かに、この概念であると
                      続いていくことに対して、"型"がある
                      基本はそれを追加して記事を書く（但し
                      "破"といって、新しくタグを追加し
                      自分の視点や観点を盛り込むことも出来る
                 未定:それでおって、新しく型を作ることも出来るようにしたいなと
                  　　　
                  -->
                  <!--
                    大事なのは、みんなが誰でも使えるようなものではなくて
                    ある程度、小規模に例えば学校のクラス１単位事にブロックを作って
                    それをみんなが使うようになれば自然とわからない所（クラス名やタグの打ち込み）
                    は友人同士でカバーされるようになる
                  -->
                  <!--
                    運用の仕方によっては
                    タグをなしにしたりとか
                    しなくて済む（タグがあってもハイライト変えるだけで
                    ある程度、穴埋め式の問題のように書けるのではないか
                    と思う
                  -->
                    <div class='ui  labels' style='margin-left:-1.7em;'>
                        <div class='ui pointing below label orange'>
                          学校
                          </div><div @click='pusha' class='ui label orange'>単体<div class='ui detail'>10</div></div><div @click='push' class='ui label orange'>問題<div class='ui detail'>10</div></div>
                        </div>
                 
    
              <div class='ui  labels' style='margin-left:-1.7em;'>
                  <div class='ui pointing below label orange'>
                    会社
                    </div><div @click='pushc' class='ui label orange'>議事録<div class='ui detail'>99</div></div>
                  </div>
            </div>
            </div>
           <div class='row view' v-if='index != null'>
             <div class='column article'>
                <div class='ui segments'>
                    <div class='ui segment'>
                        <nav class='ui indexes labels'>
                      <div class='ui pointing below label orange'>
                        files
                        </div>
                      </nav>
    
                      <section>
                        
                        <div class='ui indexes labels'>
                          <button class='ui label'><i class='icon tags'></i></button>
    
    
                        </div>
                      </section>
    
    
                      </div>
                        <div class='ui segment'>
                            <nav class='ui indexes labels'>
                          <div class='ui pointing below label orange'>
                            tmpls
                            </div>
                          </nav>
    
                          <section>
                            <!--
    
                              本をみると型がある
                              それは、例えば画像と文章の組み合わせだったり
                              画像「図解」と文章の組み合わせだったり
                              そういった種類のある型を最初に投稿して細かい箇所を
                              エディタ側で編集する
                              つまり、型（トップページの議事録とかあれ）はノートの１ページを
                              丸々テンプレ化したものになる
                              いづれはマイクロソフトが
                              エクセルの図表をそのまま読み込むエクセルの機能のように
                              雑誌をぱっと撮影刷るだけで任意のタグを作ってくれるようになるだろう
                              写真を撮影するとブロックとしてここに追記され
                              且つ
                              編集できる
                              素晴らしい
    
    
    
                            -->
                            <div class='ui indexes labels'>
                              <!-- リフィルに初期画像は俺の画像
                              俺が開発者だっていうアピール-->
                                <button class='ui label' @click="pages[index].content += `<ul class='ui list''><li>1</li><li>2</li><li>3</li></ul>`">リスト</button>
                              <button class='ui label' @click="pages[index].content += `<style></style><table id='uuid'></table>`">テーブル</button>
                              <button class='ui label' @click="pages[index].content += '<p>...</p>'">本文</button>
                              <div class='ui label' @click="pages[index].content += `<img class='ui fluid image' src='https://up.gc-img.net/post_img_web/2016/10/t7ivJlQqVFrWYhK_5226.jpeg'>`">画像</div>
                              <div class='ui label'>動画</div>
                              <div class='ui label'>題名</div>
                              <div class='ui label'>スライドショー</div>
                              <div class='ui label'>シンタックスハイライト</div>
                              <div class='ui label'>数式</div>
                              <div class='ui label'>引用</div>

    
                            </div>
                          </section>
    
    
                          </div>
                        </div>
            </div>
          </div>


</div>

     <div class='ui grid padded'>

        <div class='row controller'>
            <div class='column'>
              <div class='ui segments'  v-if='index != null'>
                <div class='ui segment editor'>
                  <codemirror v-model='pages[index].content'>
                 </codemirror>
               </div>
             </div>
              <div class='ui menu pointing icon'>
   
                <div ref='window' class='item active'> 
              <i :class="['icon',icon]"></i>
                </div>
    
  

                <div class='ui popup very basic'>
                   <div class='ui card'  v-if='index != null'>
                     <!-- リフィル:フォルダ毎にパッケージング -->
                     <!-- youtueのURLを入力すると自動でタグ解析されるとか -->
                     <!-- 2chの記事を入力すると自動で纏めてくれるとか -->
                     <!-- 画像をbase64に変換するとか -->
                     <!-- toolbox -->
                     <!-- 道具箱 -->
                     <dat-gui>
                         <dat-value label="記事選択" v-model="pages[index].classes"></dat-value>
                       </dat-gui>
                    </div>
                </div>
                <div class='menu right'>
                   <div @click="icon = 'edit'" class='item'><i class='icon edit'></i></div>
                   <div @click="icon = 'trash'" class='item'><i class='icon trash'></i></div>
                 </div>
             </div>
           </div>
         </div>
         <!-- 育てる：実に色をつける-->
      <div class='row' v-if='index != null'>
          <div class='column article'>
<div class='ui segments'>
              <div :class="['ui','page','segment',pages[index].classes]">
                  <nav class='ui labels orange'>
                    <div @click='index = null' class='ui pointing below label'>{{index.toString().padStart(5,0)}}</div><indexes @select='edit' @remove='remove(index)' @insert='insert($event,index)' class='indexes' :article='pages[index].elements'></indexes>
                 </nav>
                  <section v-html='pages[index].content'>
   
                 </section>
               </div>
              </div>

          </div>
        </div>


        <!-- 枝のように伸びる -->
        <!-- 実がなる -->
       <div class='row' v-if='index == null'>
         <div class='column article'>
           <article class='ui segments'>




            
             <template v-for='(page,i) in pages'>
                <div :class="['ui','page','segment',page.classes]">
                    <nav class='ui labels'>

                  
                  
                  
        
                        <div class='ui indexes labels indexes'><div class='ui label' v-for='(tag,name) in page.elements'>{{name}}</div></div>
                      <div @click='index = i' :class="['ui','pointing','below','label',page.color]">{{page.name}}<div :class="['ui',{'detail':page.name}]">{{i.toString().padStart(5,0)}}</div></div>
        
   
                    </nav>


                    <section v-html='page.content'>
                      
                   </section>
                 </div>



                </template>
          </article>
        </div>
      </div>
    </div>  
  </main>  
</body>
<script src='/js/native/dat-gui/0.7.6.min.js'></script>
<script src='/js/vue/plugin/dat-gui/0.0.1.min.js'></script>
<script src='/js/jquery/3.4.1.min.js'></script>
<script src='/js/jquery/plugin/fomantic-ui/2.7.8.min.js'></script>
 <script src='/js/vue/2.6.10.js'></script>
 <script src='/js/native/code-mirror/5.48.4.js'></script>
 <script src='/js/native/code-mirror/keymap/5.48.4.min.js'></script>
 <script src='/js/native/code-mirror/addon/5.48.4.min.js'></script>
 <script src='/js/native/code-mirror/mode/5.48.4.min.js'></script>
 <script src='/js/vue/plugin/code-mirror/4.0.6.min.js'></script>

 <script id='dropdown' type='text/x-template'>
  <div ref='labels' :class='ui'>
    <input name='labels' type='hidden'>
    <div class='default text'>
      <div class='ui label orange'>
        <i class='icon tags'>
       </i>
     </div>
   </div>
 </div>
</script>

 <script>


Vue.component('indexes',{
     template:'#dropdown',
     props:{
      article:{
         default:null,
         type:Object
       }
     },
     computed:{
       ui:function(){
         return ['ui dropdown selection multiple search labels'].join(' ')
       }
     },
     methods:{
       select:function($dom){
         this.$emit('select',$dom.dataset.value,this.article)
       },
       insert:function(name){
         console.dir(name)
         if (name == "{{date}}")
             name = new Date().getTime()
   
         this.$set(this.article,name,{
           content:''
         })
         this.$emit('insert',name)
       },
       remove:function(name){
         this.$delete(this.article,name)
         this.$emit('remove',name)
       }
     },
     mounted:function(){
       var self = this
       $(this.$refs.labels).dropdown({
         allowAdditions :true,
         onLabelSelect  :self.select,
         onRemove       :self.remove,
         onAdd          :self.insert,
       })

       for(val in this.article){
         $(this.$refs.labels).dropdown('add label',val,val)
       }
     }
   })

   Vue.use(VueDatGui)
   Vue.use(VueCodeMirror,{
      options:{
        scrollbarStyle  : 'simple',
        theme           : 'default',
        mode            : 'htmlmixed',
        firstLineNumber : 1,
        tabSize         : 2,
        indentUnit      : 2,
        matchTags       : {bothTags: true},
        htmlMode        : true,
        autoCloseTags   : true,
        foldGutter      : true,
        lineNumbers     : true,
        lineWrapping    : true,
        extraKeys: {
          'Ctrl-A': 'autocomplete',
          'Ctrl-Q': function(cm){
            cm.foldCode(cm.getCursor())
          },
          'F11': function(cm){
            cm.setOption("fullScreen", !cm.getOption("fullScreen"))
          }
        },
        gutters: [
          'CodeMirror-linenumbers',
          'CodeMirror-foldgutter'
        ]
      }
    })
   new Vue({
     el:'main',
     methods:{
       /* 
         ある程度、人生を豊かにする為には型が必要と思われる
         その型のこなした数と、その型を破って（新しいタグを増やして）
         書いた内容との
         バランスが
         大事
        */
       /*
        elementは配列にすること
        */
       pushc:function(){
        this.pages.push({
           classes:'',
           type:'normal',
           color:'orange',
           elements:{
             '決定':{},
             '検討':{},
             '未定':{}
           },
           content:`
             
           `
         })

         this.pages.push({
           classes:'',
           type:'normal',
           color:'orange',
           elements:{

           },
           content:''
         })  
         this.pages.push({
           classes:'',
           type:'normal',
           color:'brown',
           elements:{

           },
           content:''
         })
         this.pages.push({
           classes:'',
           type:'normal',
           color:'purple',
           elements:{

           },
           content:''
         })


       },
       pushx:function(){
        this.pages.push({
           classes:'',
           type:'normal',
           color:'orange',
           elements:{

           },
           content:`


           
<table class='ui table definition unstackable celled'>
<tbody><tr>
<td>英名</td>
<td>Tiger's eye</td>
</tr>
<tr>
<td>和名</td>
<td>虎目石</td>
</tr>
<tr>
<td>主な産地</td>
<td>南アフリカ</td>
</tr>
<tr>
<td>成分</td>
<td>NaFe(SiO<sub>3</sub>)<sub>2</sub>+混合物</td>
</tr>
<tr>
<td>結晶系</td>
<td>単斜晶系（結晶繊維の部分）</td>
</tr>
<tr>
<td>モース硬度</td>
<td>6.5 ～ 7</td>
</tr>
<tr>
<td>比重</td>
<td>2.6</td>
</tr>
<tr>
<td>色</td>
<td>褐色　黄色　黄褐色</td>
</tr>
</tbody></table>  
           
           
           `
         })
       },
       pusha:function(){
         this.pages.push({
           classes:'',
           type:'normal',
           color:'orange',
           elements:{

           },
           content:''
         })
       },
       pushb:function(){
         /*
          * この一個のpush(tree-top)を解析して自動的に以降の記事を挿入すｒ
          * 仕組みが
          * 必要
          */
         this.pages.push({
           type:'watch',
           classes:'fitted',
           color:'orange',
           elements:{
             '感想':{

             }
           },
           content:`
           
           <iframe width="100%" height="315" src="https://www.youtube.com/embed/rq3mG8yqegA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
           `
         })
         this.pages.push({
           classes:'',
           color:'grey',
           elements:{

           },
           content:'感想文'
         })



       },
       push:function(){
         /* top画面上のこのタグはD&Dによって順番を並び替えられるようにする */
         /* ってことはelementsを配列化の必要あり */
        this.pages.push({
          type:'question',
          classes:'',
          color:'orange',
          elements:{
            '問題':{

            },
            '解答':{

            }
          },
          content:''
        })
        /*
         exec */
        this.pages.push({
          classes:'',
          color:'grey',
          elements:{

          },
          content:''
        })
        this.pages.push({
          classes:'',
          color:'brown',
          elements:{

          },
          content:''
        })



       },
       insert:function(name,i){
         var len = Object.keys(this.pages[i].elements).length - 1
         var color = this.colors[len]
         
         if(this.pages[i].color != 'orange'){
           // もし"最初の始まりの色"でなければ次の階層の色についたタグ（グレー）は横方向が虹色になり（幅）、深さは同じ色になる（グレー）
           // 番号に変わりはないが色で幅と深さがわかるようになる

           // 対応として、onLabelSelectされての削除に対応すること
           // 多分配列検索になるだろうが...
           color = this.pages[i].color
         }
         
         this.pages.splice(i+len+1,0,{
           name:(this.pages[i].name !== undefined) ? this.pages[i].name + '.' + name : name,
           classes:'',
           color:color,
           content:(this.pages[i].name !== undefined) ? this.pages[i].name + '.' + name : name,
           elements:{

           }
         })
       },
       remove:function(i){
         var len = Object.keys(this.pages[i].elements).length
         // 再帰削除？
         this.pages.splice(i+len+1,1)

       },
       edit:function(){
         
       }
     },
     mounted:function(){

       $(this.$refs.window).popup({
          on:'click',
          closable:false,
          position:'left center',
       })

     },
     created:function(){
       var key = new Date().getTime()
       for(var i=0;i<10;i++){
         this.pages.push({
           classes:'',
           content:'',
           color:'orange',
           elements:{
             
           }
         })
       }
     },
     data:{
      icon:'edit',
      colors:[
      'grey',
      'brown',
      'pink',
      'purple',
      'violet',
      'blue', 
      'teal',
      'green',
      'olive',
      'yellow',
      /*
      'orange',
      'red'
      */
     ],
       index:null,
       pages:[
         
       ]
     }
   })
</script>
