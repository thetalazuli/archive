var Canvas2Image=function(){var t,e,i=(t=document.createElement("canvas"),{canvas:!!(e=t.getContext("2d")),imageData:!!e.getImageData,dataURL:!!t.toDataURL,btoa:!!window.btoa}),u="image/octet-stream";function c(t,e,n){var a=t.width,r=t.height;null==e&&(e=a),null==n&&(n=r);var o=document.createElement("canvas"),i=o.getContext("2d");return o.width=e,o.height=n,i.drawImage(t,0,0,a,r,0,0,e,n),o}function g(t,e,n,a){return(t=c(t,n,a)).toDataURL(e)}function f(t,e){var n=document.createElement("a");n.href=t,n.download=e;var a=new MouseEvent("click",{bubbles:!1,cancelable:!1});n.dispatchEvent(a)}function o(t){var e=document.createElement("img");return e.src=t,e}function m(t){return"image/"+(t=t.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/)[0]}function b(t){if(!window.btoa)throw"btoa undefined";var e="";if("string"==typeof t)e=t;else for(var n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function v(t){var e=t.width,n=t.height;return t.getContext("2d").getImageData(0,0,e,n)}function d(t,e){return"data:"+e+";base64,"+t}function s(t){var e=t.width,n=t.height,a=e*n*3,r=54+a,o=[66,77,255&r,r>>8&255,r>>16&255,r>>24&255,0,0,0,0,54,0,0,0],i=[40,0,0,0,255&e,e>>8&255,e>>16&255,e>>24&255,255&n,n>>8&255,n>>16&255,n>>24&255,1,0,24,0,0,0,0,0,255&a,a>>8&255,a>>16&255,a>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=(4-3*e%4)%4,c=t.data,g="",f=e<<2,m=n,v=String.fromCharCode;do{for(var d=f*(m-1),s="",l=0;l<e;l++){var h=l<<2;s+=v(c[d+h+2])+v(c[d+h+1])+v(c[d+h])}for(var p=0;p<u;p++)s+=String.fromCharCode(0);g+=s}while(--m);return b(o.concat(i))+b(g)}function r(t,e,n,a,r){if(i.canvas&&i.dataURL)if("string"==typeof t&&(t=document.getElementById(t)),null==a&&(a="png"),r=null==r||0===r.length?Date.now()+"."+a:r+"."+a,a=m(a),/bmp/.test(a)){var o=v(c(t,e,n));f(d(s(o),u),r)}else{f(g(t,a,e,n).replace(a,u),r)}}function a(t,e,n,a){if(i.canvas&&i.dataURL){if("string"==typeof t&&(t=document.getElementById(t)),null==a&&(a="png"),a=m(a),/bmp/.test(a)){var r=v(c(t,e,n));return o(d(s(r),"image/bmp"))}return o(g(t,a,e,n))}}return{saveAsImage:r,saveAsPNG:function(t,e,n,a){return r(t,e,n,"png",a)},saveAsJPEG:function(t,e,n,a){return r(t,e,n,"jpeg",a)},saveAsGIF:function(t,e,n,a){return r(t,e,n,"gif",a)},saveAsBMP:function(t,e,n,a){return r(t,e,n,"bmp",a)},convertToImage:a,convertToPNG:function(t,e,n){return a(t,e,n,"png")},convertToJPEG:function(t,e,n){return a(t,e,n,"jpeg")},convertToGIF:function(t,e,n){return a(t,e,n,"gif")},convertToBMP:function(t,e,n){return a(t,e,n,"bmp")}}}();